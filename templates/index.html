<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chad Meeting ‚Äî 1 —É—á–∞—Å—Ç–Ω–∏–∫</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="header">
            <div class="room-info">
                <h2>Chad Meeting</h2>
                <span class="participants-count">‚Äî 1 —É—á–∞—Å—Ç–Ω–∏–∫</span>
                <span id="room-id">{{ room_id }}</span>
            </div>
            <button id="copy-link">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="main-content">
            <!-- –í–∏–¥–µ–æ –æ–±–ª–∞—Å—Ç—å -->
            <div class="video-area">
                <div id="video-grid" class="video-grid">
                    <!-- –ó–∞–≥–ª—É—à–∫–∞ –∫–æ–≥–¥–∞ –Ω–µ—Ç –≤–∏–¥–µ–æ -->
                    <div class="video-container" id="placeholder">
                        <div class="video-placeholder">–í—ã</div>
                    </div>
                </div>
            </div>

            <!-- –ß–∞—Ç -->
            <div class="chat-container">
                <div class="chat-header">–°–æ–æ–±—â–µ–Ω–∏—è</div>
                <div id="chat" class="chat"></div>
                <div class="chat-input">
                    <input type="text" id="message-input" placeholder="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ" onkeypress="if(event.key==='Enter') document.getElementById('send-message').click();">
                    <button id="send-message">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="controls">
            <button id="toggle-mic" class="control-btn mic" title="–ú–∏–∫—Ä–æ—Ñ–æ–Ω">üé§</button>
            <button id="toggle-camera" class="control-btn camera" title="–ö–∞–º–µ—Ä–∞">üìπ</button>
            <button id="toggle-screen" class="control-btn screen" title="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞">üñ•</button>
            <button id="toggle-audio" class="control-btn audio" title="–ó–≤—É–∫">üîä</button>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ -->
    <button id="start-video" style="display: none;"></button>
    <button id="stop-video" style="display: none;"></button>
    <button id="share-screen" style="display: none;"></button>
    <button id="stop-screen" style="display: none;"></button>
    <button id="mute-audio" style="display: none;"></button>
    <button id="unmute-audio" style="display: none;"></button>
    <button id="mute-mic" style="display: none;"></button>
    <button id="unmute-mic" style="display: none;"></button>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const ROOM_ID = "{{ room_id }}";
        
        // –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        let micEnabled = true;
        let cameraEnabled = false;
        let screenEnabled = false;
        let audioEnabled = true;

        // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å—Ç–∞—Ä—ã–º –∫–Ω–æ–ø–∫–∞–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        document.getElementById('toggle-mic').addEventListener('click', () => {
            if (micEnabled) {
                document.getElementById('mute-mic').click();
            } else {
                document.getElementById('unmute-mic').click();
            }
            micEnabled = !micEnabled;
            updateButtonState('toggle-mic', micEnabled);
        });

        document.getElementById('toggle-camera').addEventListener('click', () => {
            if (cameraEnabled) {
                document.getElementById('stop-video').click();
                document.getElementById('placeholder').style.display = 'flex';
            } else {
                document.getElementById('start-video').click();
                document.getElementById('placeholder').style.display = 'none';
            }
            cameraEnabled = !cameraEnabled;
            updateButtonState('toggle-camera', cameraEnabled);
        });

        document.getElementById('toggle-screen').addEventListener('click', () => {
            if (screenEnabled) {
                document.getElementById('stop-screen').click();
            } else {
                document.getElementById('share-screen').click();
            }
            screenEnabled = !screenEnabled;
            updateButtonState('toggle-screen', screenEnabled);
        });

        document.getElementById('toggle-audio').addEventListener('click', () => {
            if (audioEnabled) {
                document.getElementById('mute-audio').click();
            } else {
                document.getElementById('unmute-audio').click();
            }
            audioEnabled = !audioEnabled;
            updateButtonState('toggle-audio', audioEnabled);
        });

        function updateButtonState(buttonId, isActive) {
            const btn = document.getElementById(buttonId);
            if (isActive) {
                btn.classList.add('active');
                btn.classList.remove('muted');
            } else {
                btn.classList.remove('active');
                if (buttonId === 'toggle-mic' || buttonId === 'toggle-audio') {
                    btn.classList.add('muted');
                }
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        document.getElementById('copy-link').addEventListener('click', () => {
            const link = window.location.href;
            navigator.clipboard.writeText(link).then(() => {
                const btn = document.getElementById('copy-link');
                const originalText = btn.textContent;
                btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        });

        console.log(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ: ${ROOM_ID}`);
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>